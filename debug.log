INFO 2024-07-10 17:42:38,980 cli 60730 8314833920 Starting server at tcp:port=8001:interface=127.0.0.1
INFO 2024-07-10 17:42:38,981 server 60730 8314833920 HTTP/2 support not enabled (install the http2 and tls Twisted extras)
INFO 2024-07-10 17:42:38,981 server 60730 8314833920 Configuring endpoint tcp:port=8001:interface=127.0.0.1
INFO 2024-07-10 17:42:38,981 server 60730 8314833920 Listening on TCP address 127.0.0.1:8001
INFO 2024-07-10 17:42:46,250 autoreload 60773 8314833920 Watching for file changes with StatReloader
INFO 2024-07-10 17:42:48,295 basehttp 60773 6157840384 "GET / HTTP/1.1" 200 1029
INFO 2024-07-10 17:42:48,575 basehttp 60773 6157840384 "GET /api/check_login_status/ HTTP/1.1" 200 21
INFO 2024-07-10 17:42:48,578 basehttp 60773 6174666752 "GET /api/room/ HTTP/1.1" 200 2
INFO 2024-07-10 17:42:48,588 basehttp 60773 6174666752 "GET /static/img/chat-icon.svg HTTP/1.1" 304 0
INFO 2024-07-10 17:42:48,668 basehttp 60773 6174666752 "GET /api/favicon.ico HTTP/1.1" 200 1029
INFO 2024-07-10 17:42:53,091 basehttp 60773 6157840384 "GET /static/js/app.js.map HTTP/1.1" 200 86775
INFO 2024-07-10 17:42:53,116 basehttp 60773 6174666752 "GET /static/js/chunk-vendors.js.map HTTP/1.1" 200 12849883
INFO 2024-07-10 17:42:54,696 basehttp 60773 6174666752 "GET /api/favicon.ico HTTP/1.1" 200 1029
INFO 2024-07-10 17:42:56,032 basehttp 60773 6174666752 "POST /api/check_username/ HTTP/1.1" 200 17
INFO 2024-07-10 17:42:56,120 basehttp 60773 6174666752 "POST /api/check_username/ HTTP/1.1" 200 17
INFO 2024-07-10 17:42:56,191 basehttp 60773 6174666752 "POST /api/check_username/ HTTP/1.1" 200 17
INFO 2024-07-10 17:42:56,308 basehttp 60773 6174666752 "POST /api/check_username/ HTTP/1.1" 200 17
INFO 2024-07-10 17:42:56,884 basehttp 60773 6174666752 "POST /api/check_username/ HTTP/1.1" 200 17
INFO 2024-07-10 17:43:00,065 basehttp 60773 6174666752 "POST /api/register/ HTTP/1.1" 201 64
INFO 2024-07-10 17:43:00,089 basehttp 60773 6174666752 "GET /static/img/chat-icon.svg HTTP/1.1" 200 1615
INFO 2024-07-10 17:43:00,096 basehttp 60773 6174666752 "GET /api/favicon.ico HTTP/1.1" 200 1029
INFO 2024-07-10 17:43:03,833 basehttp 60773 6174666752 "POST /api/login/ HTTP/1.1" 200 42
INFO 2024-07-10 17:43:04,732 basehttp 60773 6174666752 "GET /home HTTP/1.1" 200 1029
INFO 2024-07-10 17:43:04,738 basehttp 60773 6157840384 "GET /api/get_current_user/ HTTP/1.1" 200 21
INFO 2024-07-10 17:43:04,794 basehttp 60773 6174666752 "GET /api/favicon.ico HTTP/1.1" 200 1029
INFO 2024-07-10 17:43:04,794 basehttp 60773 6191493120 "GET /static/css/app.css HTTP/1.1" 200 2409
INFO 2024-07-10 17:43:04,797 basehttp 60773 6157840384 "GET /static/css/chunk-vendors.css HTTP/1.1" 200 188207
INFO 2024-07-10 17:43:04,809 basehttp 60773 6157840384 "GET /static/js/app.js HTTP/1.1" 200 26921
INFO 2024-07-10 17:43:04,838 basehttp 60773 6191493120 "GET /static/js/chunk-vendors.js HTTP/1.1" 200 4982752
INFO 2024-07-10 17:43:05,139 basehttp 60773 6174666752 "GET /api/get_current_user/ HTTP/1.1" 200 21
INFO 2024-07-10 17:43:05,143 basehttp 60773 6191493120 "GET /api/check_login_status/ HTTP/1.1" 200 20
INFO 2024-07-10 17:43:05,146 basehttp 60773 6157840384 "GET /api/room/ HTTP/1.1" 200 2
INFO 2024-07-10 17:43:05,148 basehttp 60773 6225145856 "GET /static/js/app.js.map HTTP/1.1" 200 86775
INFO 2024-07-10 17:43:05,150 basehttp 60773 6157840384 "GET /api/get_icon_color/?username=keita HTTP/1.1" 200 20
INFO 2024-07-10 17:43:05,175 basehttp 60773 6208319488 "GET /static/js/chunk-vendors.js.map HTTP/1.1" 200 12849883
INFO 2024-07-10 17:43:05,294 basehttp 60773 6208319488 "POST /api/create_default_room/ HTTP/1.1" 201 69
INFO 2024-07-10 17:43:05,305 basehttp 60773 6208319488 "GET /api/favicon.ico HTTP/1.1" 200 1029
DEBUG 2024-07-10 17:43:05,307 http_protocol 60730 8314833920 Upgraded connection ['127.0.0.1', 60738] to WebSocket
INFO 2024-07-10 17:43:05,312 basehttp 60773 6208319488 "GET /api/messages/?room_id=0 HTTP/1.1" 200 2
INFO 2024-07-10 17:43:05,314 consumers 60730 8314833920 WebSocket connection attempt: room=0, user=keita
DEBUG 2024-07-10 17:43:05,314 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60738] open and established
DEBUG 2024-07-10 17:43:05,314 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60738] accepted by application
INFO 2024-07-10 17:43:05,314 consumers 60730 8314833920 WebSocket connected: room=0
DEBUG 2024-07-10 17:43:09,950 ws_protocol 60730 8314833920 WebSocket incoming frame on ['127.0.0.1', 60738]
INFO 2024-07-10 17:43:09,952 consumers 60730 8314833920 WebSocket message received: room=0, data={"type":"chat_message","message":"<p>あいうえお</p>","username":"keita","room":0}
ERROR 2024-07-10 17:43:10,010 server 60730 8314833920 Exception inside application: 'Message' object has no attribute 'timestamp'
Traceback (most recent call last):
  File "/Users/keis/dev/chat_backend/chat/lib/python3.12/site-packages/channels/routing.py", line 62, in __call__
    return await application(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/keis/dev/chat_backend/chat/lib/python3.12/site-packages/channels/sessions.py", line 47, in __call__
    return await self.inner(dict(scope, cookies=cookies), receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/keis/dev/chat_backend/chat/lib/python3.12/site-packages/channels/sessions.py", line 263, in __call__
    return await self.inner(wrapper.scope, receive, wrapper.send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/keis/dev/chat_backend/chat/lib/python3.12/site-packages/channels/auth.py", line 185, in __call__
    return await super().__call__(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/keis/dev/chat_backend/chat/lib/python3.12/site-packages/channels/middleware.py", line 24, in __call__
    return await self.inner(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/keis/dev/chat_backend/chat/lib/python3.12/site-packages/channels/routing.py", line 132, in __call__
    return await application(
           ^^^^^^^^^^^^^^^^^^
  File "/Users/keis/dev/chat_backend/chat/lib/python3.12/site-packages/channels/consumer.py", line 94, in app
    return await consumer(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/keis/dev/chat_backend/chat/lib/python3.12/site-packages/channels/consumer.py", line 58, in __call__
    await await_many_dispatch(
  File "/Users/keis/dev/chat_backend/chat/lib/python3.12/site-packages/channels/utils.py", line 50, in await_many_dispatch
    await dispatch(result)
  File "/Users/keis/dev/chat_backend/chat/lib/python3.12/site-packages/channels/consumer.py", line 73, in dispatch
    await handler(message)
  File "/Users/keis/dev/chat_backend/chat/lib/python3.12/site-packages/channels/generic/websocket.py", line 203, in websocket_receive
    await self.receive(text_data=message["text"])
  File "/Users/keis/dev/chat_backend/chat_backend/consumers.py", line 70, in receive
    'timestamp': str(message_obj.timestamp)
                     ^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Message' object has no attribute 'timestamp'
DEBUG 2024-07-10 17:43:10,019 ws_protocol 60730 8314833920 WebSocket closed for ['127.0.0.1', 60738]
INFO 2024-07-10 17:43:18,748 basehttp 60773 6208319488 "POST /api/create-room/ HTTP/1.1" 201 61
DEBUG 2024-07-10 17:43:18,770 http_protocol 60730 8314833920 Upgraded connection ['127.0.0.1', 60791] to WebSocket
INFO 2024-07-10 17:43:18,778 consumers 60730 8314833920 WebSocket connection attempt: room=1, user=keita
DEBUG 2024-07-10 17:43:18,779 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60791] open and established
DEBUG 2024-07-10 17:43:18,779 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60791] accepted by application
INFO 2024-07-10 17:43:18,779 consumers 60730 8314833920 WebSocket connected: room=1
INFO 2024-07-10 17:43:18,782 basehttp 60773 6208319488 "GET /api/get_icon_color/?username=keita HTTP/1.1" 200 20
INFO 2024-07-10 17:43:18,788 basehttp 60773 6157840384 "GET /api/messages/?room_id=1 HTTP/1.1" 200 2
INFO 2024-07-10 17:43:18,788 basehttp 60773 6225145856 "GET /api/messages/?room_id=1 HTTP/1.1" 200 2
DEBUG 2024-07-10 17:43:18,794 http_protocol 60730 8314833920 Upgraded connection ['127.0.0.1', 60792] to WebSocket
INFO 2024-07-10 17:43:18,796 consumers 60730 8314833920 WebSocket connection attempt: room=1, user=keita
DEBUG 2024-07-10 17:43:18,796 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60792] open and established
DEBUG 2024-07-10 17:43:18,796 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60792] accepted by application
INFO 2024-07-10 17:43:18,796 consumers 60730 8314833920 WebSocket connected: room=1
INFO 2024-07-10 17:43:18,805 basehttp 60773 6225145856 "GET /api/favicon.ico HTTP/1.1" 200 1029
INFO 2024-07-10 17:43:18,808 basehttp 60773 6157840384 "GET /api/get_current_user/ HTTP/1.1" 200 21
INFO 2024-07-10 17:43:18,808 basehttp 60773 6208319488 "GET /api/get_current_user/ HTTP/1.1" 200 21
DEBUG 2024-07-10 17:43:18,810 http_protocol 60730 8314833920 Upgraded connection ['127.0.0.1', 60793] to WebSocket
INFO 2024-07-10 17:43:18,812 consumers 60730 8314833920 WebSocket connection attempt: room=1, user=keita
DEBUG 2024-07-10 17:43:18,813 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60793] open and established
DEBUG 2024-07-10 17:43:18,813 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60793] accepted by application
INFO 2024-07-10 17:43:18,813 consumers 60730 8314833920 WebSocket connected: room=1
DEBUG 2024-07-10 17:43:18,825 http_protocol 60730 8314833920 Upgraded connection ['127.0.0.1', 60794] to WebSocket
INFO 2024-07-10 17:43:18,827 consumers 60730 8314833920 WebSocket connection attempt: room=1, user=keita
DEBUG 2024-07-10 17:43:18,827 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60794] open and established
DEBUG 2024-07-10 17:43:18,827 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60794] accepted by application
INFO 2024-07-10 17:43:18,827 consumers 60730 8314833920 WebSocket connected: room=1
DEBUG 2024-07-10 17:43:18,841 http_protocol 60730 8314833920 Upgraded connection ['127.0.0.1', 60795] to WebSocket
INFO 2024-07-10 17:43:18,843 consumers 60730 8314833920 WebSocket connection attempt: room=1, user=keita
DEBUG 2024-07-10 17:43:18,843 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60795] open and established
DEBUG 2024-07-10 17:43:18,843 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60795] accepted by application
INFO 2024-07-10 17:43:18,843 consumers 60730 8314833920 WebSocket connected: room=1
DEBUG 2024-07-10 17:43:19,962 ws_protocol 60730 8314833920 WebSocket closed for ['127.0.0.1', 60795]
INFO 2024-07-10 17:43:19,962 consumers 60730 8314833920 WebSocket disconnected: room=1, code=None
DEBUG 2024-07-10 17:43:19,964 http_protocol 60730 8314833920 Upgraded connection ['127.0.0.1', 60804] to WebSocket
INFO 2024-07-10 17:43:19,968 consumers 60730 8314833920 WebSocket connection attempt: room=1, user=keita
DEBUG 2024-07-10 17:43:19,968 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60804] open and established
DEBUG 2024-07-10 17:43:19,968 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60804] accepted by application
INFO 2024-07-10 17:43:19,968 consumers 60730 8314833920 WebSocket connected: room=1
INFO 2024-07-10 17:43:19,969 basehttp 60773 6208319488 "GET /api/messages/?room_id=1 HTTP/1.1" 200 2
DEBUG 2024-07-10 17:43:19,990 http_protocol 60730 8314833920 Upgraded connection ['127.0.0.1', 60805] to WebSocket
INFO 2024-07-10 17:43:19,993 consumers 60730 8314833920 WebSocket connection attempt: room=1, user=keita
DEBUG 2024-07-10 17:43:19,993 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60805] open and established
DEBUG 2024-07-10 17:43:19,993 ws_protocol 60730 8314833920 WebSocket ['127.0.0.1', 60805] accepted by application
INFO 2024-07-10 17:43:19,993 consumers 60730 8314833920 WebSocket connected: room=1
